function [h,jx,jl]=measurement(lmk,dym)  %测量的预测值
%测量的预测
%输入路标landmark，六维向量：( x y z a b s );其中（x,y,z）为观测到路标时，摄像机位置。a,b为角度，s为深度
%输入dym：摄像机状态，（r,v,q）

K=[7.215377e+02,0.000000e+00,6.095593e+02;
    0.000000e+00 7.215377e+02 1.728540e+02;
    0.000000e+00 0.000000e+00 1.000000e+00];

R_i2c =[ 0.0083,-0.9999,0.0142;
         0.0128,-0.0141,-0.9998;
         0.9999,0.0085,0.0127];

r_i2c=[-0.3292, 0.7116, -1.0898]';

% R_i2c =[0.000998747205656553,-0.999990382071041,0.00425937848763518;
%         0.00841690182755742,-0.00425082113606946,-0.999955569675327;
%         0.999964048696658,0.00103455328422636,0.00841257520873259];
%     
% r_i2c = [1.08330191248379;-0.309888872785029;0.729919834550793];

% R_rect_02 = [9.998817e-01, 1.511453e-02 ,-2.841595e-03;
%             -1.511724e-02, 9.998853e-01, -9.338510e-04;
%               2.827154e-03, 9.766976e-04, 9.999955e-01];
%           
% P_rect_02 = [7.215377e+02, 0.000000e+00, 6.095593e+02, 4.485728e+01;
%              0.000000e+00, 7.215377e+02, 1.728540e+02, 2.163791e-01;
%               0.000000e+00, 0.000000e+00 ,1.000000e+00 ,2.745884e-03];
          
%bx = [4.485728e+01, 2.163791e-01,  2.745884e-03]';
syms x y z a b s p1 p2 p3 v1 v2 v3 q1 q2 q3 q4;
r=[p1,p2,p3].';
v=[v1,v2,v3].';
q=[q1,q2,q3,q4].';
motion_state=[r;v;q];
l=[x,y,z,a,b,s].';

% hi = qua2rotm(q)*(s*([x,y,z].'-r)+m(a,b));
% hc = R_rect_02*R_i2c*(hi-s*r_i2c);
% hc= P_rect_02*[hc;1];
hi = qua2rotm(q)*(s*([x,y,z].'-r)+m(a,b));
hc = R_i2c*(hi-s*r_i2c);
hc = K*hc;
%hc= K*hc+s*bx;

h=[hc(1)/hc(3);hc(2)/hc(3)];
jx=jacobian(h,motion_state.');
jl=jacobian(h,l.');
h=double(subs(h,{x,y,z,a,b,s,p1,p2,p3,v1,v2,v3,q1,q2,q3,q4},{lmk(1),lmk(2),lmk(3),lmk(4),lmk(5),lmk(6),dym(1),dym(2),dym(3),dym(4),dym(5),dym(6),dym(7),dym(8)...
    dym(9),dym(10)}));
jx=double(subs(jx,{x,y,z,a,b,s,p1,p2,p3,v1,v2,v3,q1,q2,q3,q4},{lmk(1),lmk(2),lmk(3),lmk(4),lmk(5),lmk(6),dym(1),dym(2),dym(3),dym(4),dym(5),dym(6),dym(7),dym(8)...
    dym(9),dym(10)}));
jl = double(subs(jl,{x,y,z,a,b,s,p1,p2,p3,v1,v2,v3,q1,q2,q3,q4},{lmk(1),lmk(2),lmk(3),lmk(4),lmk(5),lmk(6),dym(1),dym(2),dym(3),dym(4),dym(5),dym(6),dym(7),dym(8)...
    dym(9),dym(10)}));


end